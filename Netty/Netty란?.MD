





# Netty란?

기존 소켓 프로그래밍은 클라이언트 접속시 쓰레드를 할당(1:1 관계)해야 하는데

클라이언트 숫자만큼 스레드를 생성해야되기 때문에 리소스의 낭비와 문맥교환 관련문제, 입출력 데이터 무한 대기 현상 문제가 있다.



해당 네트워크 문제 때문에 새롭게 나온 방식이 **NIO(Non-Blocking Input Output)** 방식이다



기존의 소켓 통신 프로그래밍이 동기적인 네트워크 통신이라면, NIO는 비동기적인 네트워크 통신이다.



![image](https://user-images.githubusercontent.com/57785267/163330176-ed313b07-b748-4fde-ac6f-d55c0276e834.png)

![img](https://blog.kakaocdn.net/dn/ccLhoR/btqHA3CmwNH/KuKYT4KCqLkn5Md0dejjA0/img.png)



-  적은 수의 스레드로 더 많은 Connection을 이용 할 수 있어서 메모리 관리가 용이하고 **컨텍스트 스위치**에 대한 오버헤드가 줄어들게 된다. 

- 최소화 된 스레드 생성으로 여유가 생긴 잉여 스레드를 다른 작업에 할당할 수 있게된다.

- 그러나 순수 자바 라이브러리를 이용한 커넥션,네트워크 구축은 까다롭다.

​       때문에 내부에 로직이 구현된 Netty 프레임워크를 사용하는 것으로 개발자는 비즈니스 로직에만 집중할 수 있          

​       게된다.



#### 참고사항

***컨텍스트 스위칭**

```
CPU내에 존재하는 레지스터들은 현재 실행중인 프로세스 관련 데이터들로 채워진다. 
실행중인 프로세스가 변경이 되면, CPU내 레지스터들의 값이 변경되어야 하는데, 변경되기 전에 이전 프로세스가 지니고 있던 데이터들을 어딘가에 저장해 주어어야 한다.( 이어서 실행하기 위해 ). 그리고 새로 실행되는 프로세스가 아니라면 이전에 실행될 때 레지스터들이 지니고 있던 데이터들을 불러와서 이어서 실행해야 한다. 이 과정이 컨텍스트 스위칭이다. 

실행되는 프로세스의 변경 과정에서 발생하는 컨텍스트 스위칭은 시스템에 많은 부담을 준다.

레지스터 개수가 많을수록, 프로세스별로 관리되어야할 데이터 종류가 많을수록 더 부담이 된다.

컨텍스트 스위칭에 소요되는 시간을 줄이려면 저장하고 복원하는 컨텍스트 정보의 개수를 줄여주면 된다. 
```



***메모리 구조 관점에서 본 프로세스.스레드**

```
자식 프로세스가 생성되고 난 다음에는 부모프로세스가 가진 핸들테이블은 상속되지만 모든것(Code/data/heap/stack영역) 이 독립적으로 만들어진다. 이러한 메모리 구조를 지녔기에, 프로세스간에 데이터를 주고받기 위해서는 IPC(Inter Process Communication)가 필요하다.

하지만 쓰레드를 생성하는 경우 메모리 구조는 다르다. 

프로세스가 쓰레드A와 B를 생성한 경우 쓰레드를 생성할 때마다, 해당 쓰레드만을 위한 ThreadStack영역(실행 흐름의 추가를 위한 최소조건)만이 생성될 뿐, 나머지 영역(Code, Data, Heap)은 부모 프로세스 영역을 공유하고 있다. 쓰레드마다 스택을 독립적으로 할당해준다. 
```



***컨텍스트 스위칭이 빨라진 스레드와 캐쉬 적중**

```
쓰레드는 공유하는 영역이 많기 때문에 컨텍스트 스위칭이 빠르다.

 캐쉬는 CPU와 메인메모리 사이에 위치하며 CPU에서 한번 이상 읽어들인 메모리의 데이터를 저장하고 있다가, CPU가 다시 그 메모리에 저장된 데이터를 요구할 때, 메인메모리를 통하지 않고 데이터를 전달해 주는 용도이다. 

프로세스 컨텍스트 스위칭이 일어났을 경우, 공유하는 데이터가 없으므로 캐쉬가 지금껏 쌓아놓은 데이터들이 무너지고 새로 캐쉬정보를 쌓아야 한다. 이것이 프로세스 컨텍스트 스위칭에 부담이 되는 요소이다. 

반면, 쓰레드라면 저장된 캐쉬 데이터는 쓰레드가 바뀌어도 공유하는 데이터가 있으므로 의미있다. 그러므로 컨텍스트 스위칭이 빠른 것이다. 
```



### Netty 내부 구조

![img](https://blog.kakaocdn.net/dn/brvsV8/btqHG66tAZE/p1MC1HMfoRryVWkQVut6Kk/img.png)

Netty는 프로토콜 서버 및 클라이언트와 같은 네트워크 응용 프로그램을 빠르고 쉽게 개발할 수 있는 NIO 클라이언트 서버 프레임워크이다.

TCP/UDP 소켓 서버와 같은 네트워크 프로그래밍을 단순화한다.

Netty는 FTP, SMTP, HTTP, 다양한 바이너리 및 텍스트 기반 레거시 프로토콜과 같은 많은 프로토콜을 구현하여 얻은 경험을 바탕으로 신중하게 설계되었다.



**장점**

비동기식 이벤트 기반 네트워킹 지원

Tomcat서버가 10,000건의 커넥션을 처리한다면, Netty는  100,000건에서 1,000,000건의 커넥션을 처리





### SpringBoot에 Netty 적용하기

https://i-hope9.github.io/2020/12/14/SpringBoot-Netty-2-SocketServer.html 

참고

**build.gradle**

```
compile group: 'io.netty', name: 'netty-all', version: '4.1.24.Final'
```







https://www.codetd.com/ko/article/9830706

웹소켓 - netty - 연계모듈
